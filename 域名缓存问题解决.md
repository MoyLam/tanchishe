# 🔄 自定义域名显示旧版本解决方案

## 问题描述
使用国内域名绑定 Vercel 后，访问域名显示的不是最新版本。

---

## ✅ 解决方法

### 方法 1：强制刷新部署（推荐）

1. **登录 Vercel Dashboard**
   https://vercel.com/dashboard

2. **选择项目** → **Deployments**

3. **找到最新的部署**（Production 标签）

4. **点击部署** → **⋯ 菜单** → **Redeploy**

5. **勾选选项**：
   - ✅ **Use existing Build Cache** (取消勾选)
   - 这会强制重新构建，清除所有缓存

6. **点击 Redeploy**

7. **等待部署完成**（1-2 分钟）

---

### 方法 2：清除域名缓存

#### 在 Vercel Dashboard：

1. **Settings** → **Domains**

2. **找到你的自定义域名**

3. **点击域名右侧的 ⋯ 菜单**

4. **选择 "Purge Cache"**（如果可用）

---

### 方法 3：强制触发新部署

在你的本地项目中，做一个小修改并推送：

```bash
cd "e:\Project\Releases\083102贪吃蛇"

# 修改 README.md（添加一个空格）
echo "" >> README.md

# 提交并推送
git add README.md
git commit -m "触发 Vercel 重新部署"
git push origin main
```

Vercel 会自动检测到推送并重新部署。

---

### 方法 4：浏览器强制刷新

在浏览器中访问你的自定义域名：

**Windows / Linux:**
- `Ctrl + Shift + R` 或 `Ctrl + F5`

**Mac:**
- `Cmd + Shift + R`

**Chrome 开发者工具：**
1. 按 `F12` 打开开发者工具
2. 右键点击刷新按钮
3. 选择 **"清空缓存并硬性重新加载"**

---

### 方法 5：清除 DNS 缓存

#### Windows:
```cmd
ipconfig /flushdns
```

#### Mac:
```bash
sudo dscacheutil -flushcache
sudo killall -HUP mDNSResponder
```

#### Linux:
```bash
sudo systemd-resolve --flush-caches
```

---

## 🔍 验证是否更新

### 1. 检查部署时间

在浏览器中按 `F12` 打开开发者工具：

**Console 控制台运行：**
```javascript
// 查看最后更新时间
console.log(document.lastModified);

// 查看加载的配置文件
console.log(window.isConfigured);
console.log(window.SUPABASE_URL);
```

### 2. 检查 HTML 注释

查看页面源代码（右键 → 查看网页源代码），检查是否有部署时间戳。

### 3. 对比 Vercel 默认域名

访问 Vercel 提供的默认域名（`.vercel.app`），对比功能是否一致：
- 如果默认域名是新版本，说明是缓存问题
- 如果默认域名也是旧版本，说明部署没有更新

---

## ⚙️ 预防措施（推荐配置）

### 在 vercel.json 中添加缓存控制

创建或更新 `vercel.json`：

```json
{
  "cleanUrls": true,
  "trailingSlash": false,
  "headers": [
    {
      "source": "/index.html",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=0, must-revalidate"
        }
      ]
    },
    {
      "source": "/(.*).js",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    },
    {
      "source": "/supabase-config.js",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=0, must-revalidate"
        }
      ]
    }
  ]
}
```

**说明：**
- `index.html` 不缓存，每次都获取最新版本
- `.js` 文件长期缓存（使用版本控制更新）
- `supabase-config.js` 不缓存，确保配置始终最新

---

## 🚨 常见问题

### Q1: 等了很久还是旧版本？

**A:** 尝试以下组合：
1. Vercel 强制重新部署（取消 Build Cache）
2. 清除浏览器所有缓存和 Cookie
3. 使用无痕模式访问
4. 尝试不同的浏览器

### Q2: Vercel 默认域名是新的，自定义域名是旧的？

**A:** 这是 DNS 缓存或 CDN 缓存问题：
1. 等待 24-48 小时让 DNS 完全传播
2. 在 Vercel Dashboard 删除域名后重新添加
3. 联系你的域名提供商刷新 DNS

### Q3: 部署成功但自定义域名无法访问？

**A:** 检查 DNS 配置：
1. 确保 CNAME 记录指向正确的 Vercel 地址
2. 删除冲突的 A 记录或 AAAA 记录
3. 等待 DNS 传播（使用 https://dnschecker.org 检查）

### Q4: 国内域名备案问题？

**A:** 
- Vercel 的 CDN 在国内可能受限
- 考虑使用国内 CDN 加速（如阿里云、腾讯云）
- 或使用 Cloudflare 作为中间代理

---

## 📊 检查清单

部署后验证：
- [ ] Vercel 默认域名显示最新版本
- [ ] 清除浏览器缓存后访问自定义域名
- [ ] 检查浏览器控制台无错误
- [ ] 验证 DNS 记录正确配置
- [ ] 测试注册/登录功能正常
- [ ] 检查配置文件正确加载

---

## 💡 最快解决方案

**立即见效的方法（组合使用）：**

1. **Vercel 重新部署**（取消 Build Cache）
2. **清除浏览器缓存** + 使用无痕模式
3. **清除 DNS 缓存**（ipconfig /flushdns）
4. **等待 5-10 分钟**让 CDN 更新

如果还不行，请：
- 截图 Vercel 部署日志
- 提供自定义域名和默认域名
- 说明具体的差异（哪些功能不同）

---

✨ 通常重新部署 + 清除浏览器缓存就能解决问题！
